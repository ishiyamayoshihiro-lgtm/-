# Apps Script デプロイ手順（簡易版）

## ステップ1: スプレッドシートからApps Scriptを開く

1. ブラウザで以下を開く:
   https://docs.google.com/spreadsheets/d/1tryBWpHzBJzltuSbmZlr1rtwMirGR44xK8H84sgCu7I/edit

2. 上部メニュー **「拡張機能」** → **「Apps Script」** をクリック

3. Apps Scriptエディタが開く

---

## ステップ2: コードを置き換える

1. エディタ内の既存コードを **全選択**（Ctrl+A）して **削除**

2. 以下のファイルの内容を全コピー:
   ```
   G:\マイドライブ\DB\App\三角比小テスト\gas-code-ready.js
   ```

3. Apps Scriptエディタに **貼り付け**（Ctrl+V）

4. 左上の **💾保存ボタン** をクリック

5. **Ctrl + S** でも保存

---

## ステップ3: 実行テスト（エラーチェック）

1. エディタ上部の関数選択ドロップダウンで **「doGet」** を選択

2. **「実行」** ボタン（▶）をクリック

3. 「承認が必要です」と表示されたら:
   - **「権限を確認」** をクリック
   - 自分のアカウントを選択
   - 「このアプリは確認されていません」→ **「詳細」** → **「移動」**
   - **「許可」** をクリック

4. エラーが出なければOK

---

## ステップ4: デプロイ

### 方法A: 既存のデプロイを更新（推奨）

1. 右上の **「デプロイ」** をクリック

2. **「テストデプロイ」** を選択

3. 表示されたURLをコピー（後で使う）

### 方法B: それでもエラーが出る場合

ブラウザのコンソールを使って、既存のデプロイURLをそのまま使います。

**既存のURL**:
```
https://script.google.com/macros/s/AKfycbz9BsQpyV57A0KaPz8FgeiRTZUceFdqgOrfME3rv2weHXkz5MNyj-DrpXvnT98tq-wn/exec
```

このURLはそのまま使えます。デプロイの更新は不要です。

---

## ステップ5: 動作確認

1. ブラウザで既存のWebアプリURLにアクセス:
   ```
   https://script.google.com/macros/s/AKfycbz9BsQpyV57A0KaPz8FgeiRTZUceFdqgOrfME3rv2weHXkz5MNyj-DrpXvnT98tq-wn/exec
   ```

2. 以下のように表示されればOK:
   ```json
   {"status":"ok","message":"Google Apps Script is running (Secure Version)"}
   ```

---

## ステップ6: GitHubにプッシュ

1. PowerShellで実行:
   ```powershell
   cd "G:\マイドライブ\DB\App\三角比小テスト"
   git add script.js
   git commit -m "セキュリティ強化: サーバー側採点、JWT検証、セッション管理を実装"
   git push origin main
   ```

2. 1〜2分待つ

3. アプリにアクセスしてテスト:
   ```
   https://ishiyamayoshihiro-lgtm.github.io/-/
   ```

---

## トラブルシューティング

### 問題: 「テストデプロイ」が見つからない

→ 既存のURLをそのまま使ってください（config.js変更不要）

### 問題: コードを保存してもデプロイが更新されない

→ Apps Scriptは自動的に最新コードを使います。デプロイし直す必要はありません。

### 問題: アプリでエラーが出る

→ ブラウザのコンソール（F12）でエラー内容を確認してください。
