# 三角比小テスト 開発メモ

## 更新作業の手順

### testver表記の目的と管理方法

**重要：testverは「三角比小テスト」のタイトルの下に常時表示し、GitHubのデータが更新されたかどうかを画面上で確認するために使用します。**

#### 目的
- GitHub Pagesにプッシュした変更が実際に反映されているかを確認するため
- ブラウザのキャッシュではなく、最新版が表示されているかを判断するため
- 更新履歴を追跡しやすくするため

#### 表示場所
index.htmlのヘッダー部分に常に表示：
```html
<header>
    <h1>三角比小テスト</h1>
    <p class="subtitle">角度から三角比の値を求めよう</p>
    <p class="version">testver.14</p>  <!-- ここに表示 -->
</header>
```

style.cssで以下のスタイルが定義済み：
```css
.version {
    font-size: 0.8rem;
    opacity: 0.6;
    margin-top: 5px;
}
```

#### 更新ルール
1. **機能追加・修正のたびにバージョン番号を上げる**
   - testver.1 → testver.2 → testver.3 → testver.14 ...

2. **コミットメッセージにもバージョン番号を含める**
   - 例: `git commit -m "testver.14: iPadで回答ボタンの色が残る問題を修正"`

3. **index.htmlのバージョン表記を必ず更新する**
   - script.jsやstyle.cssを更新したら、index.htmlのtestverも必ず更新すること
   - これを忘れると、GitHub Pagesで反映確認ができなくなる

4. **確認方法**
   - GitHub Pagesにアクセス
   - Ctrl + Shift + R で強制リロード
   - ヘッダーにバージョン番号が表示されていることを確認
   - バージョン番号が更新されていれば、GitHubのデータが反映されている

#### メリット
- GitHubへの反映確認が画面上で一目で分かる
- キャッシュ問題とサーバー未反映を区別できる
- 複数回の修正試行時に進捗を追跡できる
- 利用者も最新版を使っているかを確認できる

---

## プロジェクト構成

### 主要ファイル
- `index.html` - メインHTML
- `script.js` - JavaScriptロジック
- `style.css` - スタイル定義
- `config.js` - 設定ファイル（Google Client ID、GAS URL）

### GASファイル
- `gas-code.js` - テンプレート（SPREADSHEET_ID未設定）
- `gas-code-ready.js` - 本番用（SPREADSHEET_ID設定済み）

### ドキュメント
- `モード切替方法.md` - モード切替手順（現在は使用していない）
- `更新履歴.md` - 機能追加・変更の記録
- `開発メモ.md` - このファイル

---

## デプロイフロー

1. **ローカルで変更**
   ```bash
   git add .
   git commit -m "変更内容"
   git push
   ```

2. **GitHub Pagesへの反映**
   - プッシュから1〜2分で自動反映
   - 設定: Settings → Pages → Branch: main

3. **GASの更新が必要な場合**
   - `gas-code-ready.js` を編集
   - Google Apps Script エディタで更新
   - 既存デプロイを編集して「新バージョン」で再デプロイ

---

## トラブルシューティング

### 変更が反映されない
1. Ctrl + Shift + R で強制リロード
2. シークレットモードで確認
3. testver表示で実際に更新されているか確認

### スプレッドシートに送信されない
1. ブラウザコンソール（F12）でエラー確認
2. GASのログ確認（Apps Script エディタ → 実行ログ）
3. config.jsのURLが正しいか確認

### ボタン幅が揃わない
- KaTeXの内容が長すぎる → 内容を短縮
- position: relativeの影響 → ボタン全体の幅を広げる
- CSS Gridの列幅 → grid-template-columnsを調整

---

**作成日: 2025年10月27日**
